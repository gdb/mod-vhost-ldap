# -*- makefile -*-
#
# Extra magic needed by the LaTeX->SGML conversion process.  This requires
# $(TOOLSDIR) to be properly defined.
#
# Note that docfixer.py outputs XML directly; this will be fixed before too
# much longer.

DOCFIXER=	$(TOOLSDIR)/sgmlconv/docfixer.py
ESIS2SGML=	$(TOOLSDIR)/sgmlconv/esis2sgml.py
ESIS2XML=	$(TOOLSDIR)/sgmlconv/esis2sgml.py --xml
FIXGES=		$(TOOLSDIR)/sgmlconv/fixgenents.sh
LATEX2ESIS=	$(TOOLSDIR)/sgmlconv/latex2esis.py

CUTCRUFT=	grep -v '^<?xml version="1.0"?>$$'


XMLTARGETS=	$(patsubst %.tex,%.xml,$(wildcard *.tex))

.SUFFIXES: .tex .xml

.tex.xml:
	$(LATEX2ESIS) $< | $(DOCFIXER) | $(CUTCRUFT) | $(FIXGES) > $@


all:	$(XMLTARGETS)


$(XMLTARGETS): $(DOCFIXER) $(LATEX2ESIS) $(FIXGES)
